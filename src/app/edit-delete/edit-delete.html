<div class="manage-container" [class.sidebar-open]="isSidebarOpen">
  <!-- Sidebar -->
  <app-sidebar [isAdmin]="isAdmin" (close)="toggleSidebar()"></app-sidebar>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" (click)="toggleSidebar()"></div>

  <!-- Main Content -->
  <main class="main-content">
    <button class="menu-toggle-btn" (click)="toggleSidebar()">
      <i class="bi bi-list"></i>
    </button>

    <!-- User Navbar -->
    <div class="user-navbar">
      <h2 class="page-title">Manage Content</h2>
      <div class="user-menu">
        <span class="user-name">{{ userName }}</span>
        <div class="dropdown">
          <button class="dropdown-toggle" (click)="toggleDropdown()">
            <i class="bi bi-chevron-down"></i>
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a *ngIf="isLoggedIn" (click)="handleLogout()">Logout</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="alert alert-error">
      <i class="bi bi-exclamation-circle"></i>
      <span>{{ errorMessage }}</span>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
      <i class="bi bi-check-circle"></i>
      <span>{{ successMessage }}</span>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button
          class="tab-btn"
          [class.active]="activeTab === 'category'"
          (click)="switchTab('category')"
        >
          <i class="bi bi-tag"></i>
          Categories
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'course'"
          (click)="switchTab('course')"
        >
          <i class="bi bi-play-circle"></i>
          Courses
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'lesson'"
          (click)="switchTab('lesson')"
        >
          <i class="bi bi-film"></i>
          Lessons
        </button>

        <button
          class="tab-btn"
          [class.active]="activeTab === 'doctor'"
          (click)="switchTab('doctor')"
        >
          <i class="bi bi-people"></i>
          Doctors
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'suggestion'"
          (click)="switchTab('suggestion')"
        >
          <i class="bi bi-lightbulb"></i>
          Suggestions
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tabs-content">
        <!-- Categories Tab -->
        <div class="tab-pane" *ngIf="activeTab === 'category'">
          <h3 class="tab-title">Manage Categories</h3>

          <div *ngIf="loadingCategories" class="loading-state">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading categories...</p>
          </div>

          <div *ngIf="!loadingCategories && categories.length === 0" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No categories found</p>
          </div>

          <div *ngIf="!loadingCategories && categories.length > 0" class="items-grid">
            <div *ngFor="let cat of categories" class="item-card">
              <img [src]="cat.imageUrl" [alt]="cat.title" class="item-thumbnail" />
              <div class="item-content">
                <h4 class="item-title">{{ cat.title }}</h4>
                <p class="item-meta">{{ cat.about }}</p>
              </div>
              <div class="item-actions">
                <button class="btn-icon btn-edit" (click)="openEditCategoryModal(cat)" title="Edit">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn-icon btn-delete" (click)="deleteCategory(cat.id)" title="Delete">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Courses Tab -->
        <div class="tab-pane" *ngIf="activeTab === 'course'">
          <h3 class="tab-title">Manage Courses</h3>

          <div *ngIf="loadingCourses" class="loading-state">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading courses...</p>
          </div>

          <div *ngIf="!loadingCourses && courses.length === 0" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No courses found</p>
          </div>

          <div *ngIf="!loadingCourses && courses.length > 0" class="items-grid">
            <div *ngFor="let course of courses" class="item-card">
              <img
                [src]="course.courseImagePath"
                [alt]="course.courseTitle"
                class="item-thumbnail"
              />
              <div class="item-content">
                <h4 class="item-title">{{ course.courseTitle }}</h4>
                <p class="item-meta">By {{ course.courseCreator }}</p>
                <p class="item-meta">Price: ${{ course.coursePrice }}</p>
              </div>
              <div class="item-actions">
                <button
                  class="btn-icon btn-edit"
                  (click)="openEditCourseModal(course)"
                  title="Edit"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn-icon btn-delete"
                  (click)="deleteCourse(course.courseId)"
                  title="Delete"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Lessons Tab -->
        <div class="tab-pane" *ngIf="activeTab === 'lesson'">
          <h3 class="tab-title">Manage Lessons</h3>

          <!-- Course Filter -->
          <div class="filter-section">
            <div class="filter-group">
              <label for="courseFilter">Select Course to View Lessons</label>
              <select
                id="courseFilter"
                class="form-control filter-select"
                [value]="selectedCourseId"
                (change)="onCourseFilterChange($event)"
              >
                <option value="">-- Choose a Course --</option>
                <option *ngFor="let course of courses" [value]="course.courseId">
                  {{ course.courseTitle }}
                </option>
              </select>
            </div>
          </div>

          <div *ngIf="!selectedCourseId" class="info-state">
            <i class="bi bi-info-circle"></i>
            <p>Please select a course to view its lessons</p>
          </div>

          <div *ngIf="selectedCourseId && loadingLessons" class="loading-state">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading lessons...</p>
          </div>

          <div
            *ngIf="selectedCourseId && !loadingLessons && lessons.length === 0"
            class="empty-state"
          >
            <i class="bi bi-inbox"></i>
            <p>No lessons found for this course</p>
          </div>

          <div
            *ngIf="selectedCourseId && !loadingLessons && lessons.length > 0"
            class="items-table"
          >
            <table>
              <thead>
                <tr>
                  <th>Lesson Title</th>
                  <th>Course</th>
                  <th>Order</th>
                  <th>Type</th>
                  <th>Duration</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let lesson of lessons">
                  <td class="lesson-title">{{ lesson.title }}</td>
                  <td>{{ lesson.courseTitle }}</td>
                  <td>{{ lesson.arrange }}</td>
                  <td>
                    <span
                      class="badge"
                      [class.badge-free]="lesson.isFree"
                      [class.badge-premium]="!lesson.isFree"
                    >
                      {{ lesson.isFree ? 'Free' : 'Premium' }}
                    </span>
                  </td>
                  <td>{{ formatDuration(lesson.durationInMinutes) }}</td>
                  <td class="actions-cell">
                    <button
                      class="btn-icon btn-edit"
                      (click)="openEditLessonModal(lesson)"
                      title="Edit"
                    >
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button
                      class="btn-icon btn-delete"
                      (click)="deleteLesson(lesson.id)"
                      title="Delete"
                    >
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Sliders Tab -->
        <div class="tab-pane" *ngIf="activeTab === 'slider'">
          <h3 class="tab-title">Manage Sliders</h3>

          <div *ngIf="loadingSliders" class="loading-state">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading sliders...</p>
          </div>

          <div *ngIf="!loadingSliders && sliders.length === 0" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No sliders found</p>
          </div>

          <div *ngIf="!loadingSliders && sliders.length > 0" class="items-grid">
            <div *ngFor="let slider of sliders" class="item-card">
              <img [src]="slider.path" [alt]="slider.title" class="item-thumbnail" />
              <div class="item-content">
                <h4 class="item-title">{{ slider.title }}</h4>
                <p class="item-meta" *ngIf="slider.link">Link: {{ slider.link }}</p>
              </div>
              <div class="item-actions">
                <!-- <button
                  class="btn-icon btn-edit"
                  (click)="openEditSliderModal(slider)"
                  title="Edit"
                >
                  <i class="bi bi-pencil"></i>
                </button> -->
                <button
                  class="btn-icon btn-delete"
                  (click)="deleteSlider(slider.id)"
                  title="Delete"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Suggestions Tab -->
        <div class="tab-pane" *ngIf="activeTab === 'suggestion'">
          <h3 class="tab-title">Manage Suggestions</h3>

          <div *ngIf="loadingSuggestions" class="loading-state">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading suggestions...</p>
          </div>

          <div *ngIf="!loadingSuggestions && suggestions.length === 0" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No suggestions found</p>
          </div>

          <div *ngIf="!loadingSuggestions && suggestions.length > 0" class="items-table">
            <table>
              <thead>
                <tr>
                  <th>Video Title</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let suggestion of suggestions">
                  <td>{{ suggestion.title }}</td>
                  <td class="actions-cell">
                    <button
                      class="btn-icon btn-edit"
                      (click)="openEditSuggestionModal(suggestion)"
                      title="Edit"
                    >
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button
                      class="btn-icon btn-delete"
                      (click)="deleteSuggestion(suggestion.id)"
                      title="Delete"
                    >
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Doctors Tab -->
        <div class="tab-pane" *ngIf="activeTab === 'doctor'">
          <h3 class="tab-title">Manage Doctors</h3>

          <div *ngIf="loadingDoctors" class="loading-state">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading doctors...</p>
          </div>

          <div *ngIf="!loadingDoctors && doctors.length === 0" class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No doctors found</p>
          </div>

          <div *ngIf="!loadingDoctors && doctors.length > 0" class="items-grid">
            <div *ngFor="let doctor of doctors" class="item-card">
              <img
                [src]="doctor.imageUrl || 'assets/default-avatar.png'"
                [alt]="doctor.name"
                class="item-thumbnail doctor-thumbnail"
              />
              <div class="item-content">
                <h4 class="item-title">{{ doctor.name }}</h4>
                <p class="item-meta">{{ doctor.specialty }}</p>
              </div>
              <div class="item-actions">
                <button
                  class="btn-icon btn-edit"
                  (click)="openEditDoctorModal(doctor)"
                  title="Edit"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn-icon btn-delete"
                  (click)="deleteDoctor(doctor.id)"
                  title="Delete"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Edit Category Modal -->
<div class="modal" [class.show]="showEditCategoryModal" *ngIf="showEditCategoryModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Category</h3>
      <button class="modal-close" (click)="closeModals()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <form [formGroup]="editCategoryForm" (ngSubmit)="submitEditCategory()" class="modal-body">
      <div class="form-group">
        <label>Category Title <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="title"
          [class.error]="
            editCategoryForm.get('title')?.invalid && editCategoryForm.get('title')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>About</label>
        <textarea class="form-control" formControlName="about" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label>Category Image</label>
        <div class="upload-box">
          <i class="bi bi-image"></i>
          <p>Upload New Image (Optional)</p>
          <input
            type="file"
            class="file-input"
            (change)="onCategoryImageChange($event)"
            accept="image/jpeg, image/png"
          />
        </div>
        <div *ngIf="editCategoryImagePreview" class="thumbnail-preview">
          <img [src]="editCategoryImagePreview" alt="Preview" />
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" (click)="closeModals()">Cancel</button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editCategoryForm.invalid || submitting"
        >
          {{ submitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Course Modal -->
<div class="modal" [class.show]="showEditCourseModal" *ngIf="showEditCourseModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Course</h3>
      <button class="modal-close" (click)="closeModals()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <form [formGroup]="editCourseForm" (ngSubmit)="submitEditCourse()" class="modal-body">
      <div class="form-group">
        <label>Course Title <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="title"
          [class.error]="
            editCourseForm.get('title')?.invalid && editCourseForm.get('title')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>Category <span class="required">*</span></label>
        <select
          class="form-control"
          formControlName="categoryId"
          [class.error]="
            editCourseForm.get('categoryId')?.invalid && editCourseForm.get('categoryId')?.touched
          "
        >
          <option value="">-- Select Category --</option>
          <option *ngFor="let cat of categories" [value]="cat.id">
            {{ cat.title }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label>Price <span class="required">*</span></label>
        <input
          type="number"
          class="form-control"
          formControlName="price"
          [class.error]="
            editCourseForm.get('price')?.invalid && editCourseForm.get('price')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>Instructor Name <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="instructorName"
          [class.error]="
            editCourseForm.get('instructorName')?.invalid &&
            editCourseForm.get('instructorName')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>Course Thumbnail</label>
        <div class="upload-box">
          <i class="bi bi-image"></i>
          <p>Upload New Thumbnail (Optional)</p>
          <input
            type="file"
            class="file-input"
            (change)="onCourseImageChange($event)"
            accept="image/jpeg, image/png"
          />
        </div>
        <div *ngIf="editCourseImagePreview" class="thumbnail-preview">
          <img [src]="editCourseImagePreview" alt="Preview" />
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" (click)="closeModals()">Cancel</button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editCourseForm.invalid || submitting"
        >
          {{ submitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Lesson Modal -->
<div class="modal" [class.show]="showEditLessonModal" *ngIf="showEditLessonModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Lesson</h3>
      <button class="modal-close" (click)="closeModals()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <form [formGroup]="editLessonForm" (ngSubmit)="submitEditLesson()" class="modal-body">
      <div class="form-group">
        <label>Lesson Title <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="title"
          [class.error]="
            editLessonForm.get('title')?.invalid && editLessonForm.get('title')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>Lesson Order <span class="required">*</span></label>
        <input
          type="number"
          class="form-control"
          formControlName="order"
          [class.error]="
            editLessonForm.get('order')?.invalid && editLessonForm.get('order')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>Is Free? <span class="required">*</span></label>
        <select class="form-control" formControlName="isFree">
          <option [value]="true">Free</option>
          <option [value]="false">Premium</option>
        </select>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" (click)="closeModals()">Cancel</button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editLessonForm.invalid || submitting"
        >
          {{ submitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Slider Modal -->

<!-- Edit Suggestion Modal -->
<div class="modal" [class.show]="showEditSuggestionModal" *ngIf="showEditSuggestionModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Suggestion</h3>
      <button class="modal-close" (click)="closeModals()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <form [formGroup]="editSuggestionForm" (ngSubmit)="submitEditSuggestion()" class="modal-body">
      <div class="form-group">
        <label>Title <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="title"
          [class.error]="
            editSuggestionForm.get('title')?.invalid && editSuggestionForm.get('title')?.touched
          "
        />
      </div>
      <!-- <div class="form-group">
          <label>Instructor Name <span class="required">*</span></label>
          <input
            type="text"
            class="form-control"
            formControlName="instructorName"
            [class.error]="
              editSuggestionForm.get('instructorName')?.invalid &&
              editSuggestionForm.get('instructorName')?.touched
            "
          />
        </div> -->
      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" (click)="closeModals()">Cancel</button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editSuggestionForm.invalid || submitting"
        >
          {{ submitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Doctor Modal -->
<div class="modal" [class.show]="showEditDoctorModal" *ngIf="showEditDoctorModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Doctor</h3>
      <button class="modal-close" (click)="closeModals()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <form [formGroup]="editDoctorForm" (ngSubmit)="submitEditDoctor()" class="modal-body">
      <div class="form-group">
        <label>Name <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="name"
          [class.error]="editDoctorForm.get('name')?.invalid && editDoctorForm.get('name')?.touched"
        />
      </div>
      <div class="form-group">
        <label>Specialty <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="specialty"
          [class.error]="
            editDoctorForm.get('specialty')?.invalid && editDoctorForm.get('specialty')?.touched
          "
        />
      </div>
      <div class="form-group">
        <label>About <span class="required">*</span></label>
        <textarea
          class="form-control"
          formControlName="about"
          rows="3"
          [class.error]="
            editDoctorForm.get('about')?.invalid && editDoctorForm.get('about')?.touched
          "
        ></textarea>
      </div>
      <div class="form-group">
        <label>Expertise <span class="required">*</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="expertise"
          placeholder="Comma separated"
        />
      </div>

      <div class="form-group">
        <label>Facebook</label>
        <input type="text" class="form-control" formControlName="facebook" />
      </div>
      <div class="form-group">
        <label>WhatsApp</label>
        <input type="text" class="form-control" formControlName="whatsapp" />
      </div>
      <div class="form-group">
        <label>Instagram</label>
        <input type="text" class="form-control" formControlName="instagram" />
      </div>

      <div class="form-group">
        <label>Doctor Photo</label>
        <div class="upload-box">
          <i class="bi bi-image"></i>
          <p>Upload New Photo (Optional)</p>
          <input
            type="file"
            class="file-input"
            (change)="onDoctorImageChange($event)"
            accept="image/jpeg, image/png"
          />
        </div>
        <div *ngIf="editDoctorImagePreview" class="thumbnail-preview">
          <img
            [src]="editDoctorImagePreview"
            alt="Preview"
            class="item-thumbnail doctor-thumbnail"
          />
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" (click)="closeModals()">Cancel</button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editDoctorForm.invalid || submitting"
        >
          {{ submitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal modal-danger" [class.show]="showDeleteConfirm" *ngIf="showDeleteConfirm">
  <div class="modal-content modal-small">
    <div class="modal-header">
      <h3>Confirm Delete</h3>
      <button class="modal-close" (click)="cancelDelete()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this item? This action cannot be undone.</p>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn btn-cancel" (click)="cancelDelete()">Cancel</button>
      <button
        type="button"
        class="btn btn-danger"
        (click)="confirmDelete()"
        [disabled]="submitting"
      >
        {{ submitting ? 'Deleting...' : 'Delete' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal Overlay -->
<div
  class="modal-overlay"
  [class.show]="
    showEditCategoryModal ||
    showEditCourseModal ||
    showEditLessonModal ||
    showEditSliderModal ||
    showEditSuggestionModal ||
    showEditDoctorModal ||
    showDeleteConfirm
  "
  (click)="closeModals()"
></div>
