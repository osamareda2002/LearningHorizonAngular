<div class="sessions-container" [class.sidebar-open]="isSidebarOpen">
  <!-- Sidebar -->
  <app-sidebar [isAdmin]="isAdmin" (close)="toggleSidebar()"></app-sidebar>
  <div class="sidebar-overlay" (click)="toggleSidebar()"></div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- User Navbar -->
    <div class="user-navbar">
      <div class="page-title-container">
        <button class="menu-toggle-btn" (click)="toggleSidebar()">
          <i class="bi bi-list"></i>
        </button>
        <h2 class="page-title">Sessions</h2>
      </div>

      <div class="user-menu">
        <span class="user-name">{{ userName }}</span>
        <div class="dropdown">
          <button class="dropdown-toggle" (click)="toggleDropdown()">
            <i class="bi bi-chevron-down"></i>
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a *ngIf="isLoggedIn" (click)="handleLogout()">Logout</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="alert alert-error">
      <i class="bi bi-exclamation-circle"></i>
      <span>{{ errorMessage }}</span>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
      <i class="bi bi-check-circle"></i>
      <span>{{ successMessage }}</span>
    </div>

    <!-- Add Meeting Button (Admin Only) -->
    <div class="header-actions" *ngIf="isAdmin">
      <button class="btn btn-primary" (click)="openAddMeetingModal()">
        <i class="bi bi-plus-circle"></i>
        Add New Meeting
      </button>
    </div>

    <!-- Meetings List -->
    <div class="meetings-container">
      <div *ngIf="loadingMeetings" class="loading-state">
        <i class="bi bi-hourglass-split"></i>
        <p>Loading sessions...</p>
      </div>

      <div *ngIf="!loadingMeetings && meetings.length === 0" class="empty-state">
        <i class="bi bi-camera-video"></i>
        <p>No sessions available</p>
      </div>

      <div *ngIf="!loadingMeetings && meetings.length > 0" class="meetings-grid">
        <div
          *ngFor="let meeting of meetings"
          class="meeting-card"
          [class.finished]="getMeetingStatus(meeting) === 'finished'"
        >
          <div class="meeting-header">
            <div class="meeting-icon">
              <i class="bi bi-camera-video-fill"></i>
            </div>
            <div
              class="meeting-badge"
              [class.badge-live]="getMeetingStatus(meeting) === 'live'"
              [class.badge-scheduled]="getMeetingStatus(meeting) === 'scheduled'"
              [class.badge-waiting]="getMeetingStatus(meeting) === 'waiting'"
              [class.badge-finished]="getMeetingStatus(meeting) === 'finished'"
            >
              <i
                class="bi"
                [class.bi-record-circle]="getMeetingStatus(meeting) === 'live'"
                [class.bi-clock]="getMeetingStatus(meeting) === 'scheduled'"
                [class.bi-hourglass-split]="getMeetingStatus(meeting) === 'waiting'"
                [class.bi-check-circle]="getMeetingStatus(meeting) === 'finished'"
              ></i>
              <span>{{ getMeetingStatusMessage(meeting) }}</span>
            </div>
          </div>

          <div class="meeting-body">
            <h3 class="meeting-title">{{ meeting.topic }}</h3>
            <div class="meeting-info">
              <div class="info-item">
                <i class="bi bi-person"></i>
                <span>Host: {{ meeting.hostName }}</span>
              </div>
              <div class="info-item">
                <i class="bi bi-calendar3"></i>
                <span>{{ meeting.startTime | date : 'MMM d, y' }}</span>
              </div>
              <div class="info-item">
                <i class="bi bi-clock"></i>
                <span>{{ meeting.startTime | date : 'h:mm a' }}</span>
              </div>
            </div>
          </div>

          <div class="meeting-actions">
            <button
              class="btn"
              [class.btn-join]="canJoinMeeting(meeting)"
              [class.btn-disabled]="!canJoinMeeting(meeting)"
              [disabled]="!canJoinMeeting(meeting)"
              (click)="joinMeeting(meeting)"
            >
              <i
                class="bi"
                [class.bi-box-arrow-in-right]="canJoinMeeting(meeting)"
                [class.bi-lock]="!canJoinMeeting(meeting)"
              ></i>
              <span *ngIf="canJoinMeeting(meeting)">Join Meeting</span>
              <span *ngIf="!canJoinMeeting(meeting) && getMeetingStatus(meeting) === 'scheduled'"
                >Not Started</span
              >
              <span *ngIf="!canJoinMeeting(meeting) && getMeetingStatus(meeting) === 'waiting'"
                >Waiting for Host</span
              >
              <span *ngIf="!canJoinMeeting(meeting) && getMeetingStatus(meeting) === 'finished'"
                >Meeting Ended</span
              >
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Meeting Modal -->
  <div class="modal" [class.show]="showAddMeetingModal" *ngIf="showAddMeetingModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New Meeting</h3>
        <button class="modal-close" (click)="closeModal()">
          <i class="bi bi-x"></i>
        </button>
      </div>
      <form [formGroup]="meetingForm" (ngSubmit)="submitMeeting()" class="modal-body">
        <div class="form-group">
          <label>Meeting Topic <span class="required">*</span></label>
          <input
            type="text"
            class="form-control"
            formControlName="topic"
            placeholder="Enter meeting topic"
            [class.error]="meetingForm.get('topic')?.invalid && meetingForm.get('topic')?.touched"
          />
        </div>

        <div class="form-group">
          <label>Start Time <span class="required">*</span></label>
          <input
            type="datetime-local"
            class="form-control"
            formControlName="startTime"
            [class.error]="
              meetingForm.get('startTime')?.invalid && meetingForm.get('startTime')?.touched
            "
          />
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-cancel" (click)="closeModal()">Cancel</button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="meetingForm.invalid || submitting"
          >
            {{ submitting ? 'Creating...' : 'Create Meeting' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" [class.show]="showAddMeetingModal" (click)="closeModal()"></div>
</div>
