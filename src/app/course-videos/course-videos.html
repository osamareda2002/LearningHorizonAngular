<div class="course-videos-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading course...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && course" class="content-wrapper">
    <!-- Left Side - Video Player & Course Info -->
    <div class="left-section">
      <!-- Back Button -->
      <button class="btn-back" (click)="goBackToCourses()">
        <i class="bi bi-arrow-left"></i>
        <span>Back to Courses</span>
      </button>

      <!-- Course Title -->
      <div class="course-header">
        <h1 class="course-title">{{ course.courseTitle }}</h1>
        <span class="title-underline"></span>
      </div>

      <!-- Video Player -->
      <div class="video-player-wrapper">
        <iframe *ngIf="currentVideoUrl && currentLesson" [src]="currentVideoUrl" loading="lazy" class="video-player"
          style="border: 0; width: 100%; height: 100%;"
          allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
        <div *ngIf="!currentVideoUrl || !currentLesson" class="video-placeholder">
          <i class="bi bi-play-circle"></i>
          <p>Select a lesson to watch</p>
        </div>
      </div>

      <!-- Start MCQ Quiz Button -->
      <button *ngIf="currentLesson && currentExercises.length > 0 && !showMCQQuiz" class="btn-start-mcq"
        (click)="startMCQQuiz()">
        <i class="bi bi-file-earmark-text"></i>
        Start MCQ Quiz
      </button>

      <!-- MCQ Quiz Section -->
      <div *ngIf="showMCQQuiz && currentExercises.length > 0" id="mcq-quiz-section" class="mcq-quiz-section">
        <div class="mcq-quiz-header">
          <h2 class="mcq-quiz-title">
            <i class="bi bi-question-circle"></i>
            Question {{ currentQuestionIndex + 1 }} of {{ currentExercises.length }}
          </h2>
          <button class="btn-close-quiz" (click)="closeQuiz()" title="Close Quiz">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <div class="mcq-question-container">
          <div *ngFor="let exercise of currentExercises; let questionIndex = index" class="mcq-question-card"
            [id]="'question-' + questionIndex" [class.active]="currentQuestionIndex === questionIndex">
            <!-- Question Text -->
            <div class="mcq-question-header">
              <div class="mcq-question-icon">
                <i class="bi bi-question-circle-fill"></i>
              </div>
              <h3 class="mcq-question-text">{{ exercise.questionText }}</h3>
            </div>

            <!-- Question Image (if available) -->
            <div *ngIf="exercise.imageUrl || exercise.imageLink" class="mcq-question-image">
              <img [src]="exercise.imageUrl || exercise.imageLink"
                [alt]="'Question ' + (questionIndex + 1) + ' image'" />
            </div>

            <!-- Answer Options -->
            <div class="mcq-answers">
              <label *ngFor="let answer of exercise.answers; let answerIndex = index" class="mcq-answer-option"
                [class.selected]="selectedAnswers[questionIndex] === answerIndex"
                [class.correct]="selectedAnswers[questionIndex] !== undefined && answer.isCorrect"
                [class.wrong]="selectedAnswers[questionIndex] === answerIndex && !answer.isCorrect">
                <input type="radio" [name]="'question-' + questionIndex" [value]="answerIndex"
                  [checked]="selectedAnswers[questionIndex] === answerIndex"
                  (change)="selectAnswer(questionIndex, answerIndex)" [disabled]="quizSubmitted" />
                <span class="mcq-answer-letter">{{ getCharCode(answerIndex) }}</span>
                <span class="mcq-answer-text">{{ answer.answerText }}</span>
                <i *ngIf="quizSubmitted && answer.isCorrect" class="bi bi-check-circle-fill correct-icon"></i>
                <i *ngIf="
                    quizSubmitted &&
                    selectedAnswers[questionIndex] === answerIndex &&
                    !answer.isCorrect
                  " class="bi bi-x-circle-fill wrong-icon"></i>
              </label>
            </div>

            <!-- Explanation (shown after answer is selected) -->
            <div *ngIf="selectedAnswers[questionIndex] !== undefined && exercise.explanation" class="mcq-explanation">
              <strong>Explanation:</strong> {{ exercise.explanation }}
            </div>
          </div>
        </div>

        <!-- Quiz Navigation and Submit -->
        <div class="mcq-quiz-actions">
          <div class="mcq-quiz-nav">
            <button class="btn-quiz-nav" (click)="previousQuestion()" [disabled]="currentQuestionIndex === 0">
              <i class="bi bi-chevron-left"></i>
              Previous
            </button>
            <span class="quiz-progress">
              Question {{ currentQuestionIndex + 1 }} / {{ currentExercises.length }}
            </span>
            <button class="btn-quiz-nav" (click)="nextQuestion()"
              [disabled]="currentQuestionIndex === currentExercises.length - 1">
              Next
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>

          <button *ngIf="!quizSubmitted" class="btn-submit-quiz" (click)="submitQuiz()"
            [disabled]="getObjectKeys(selectedAnswers).length < currentExercises.length">
            Submit Quiz
          </button>

          <!-- Quiz Results -->
          <div *ngIf="quizSubmitted" class="quiz-results">
            <div class="quiz-score">
              <h3>Quiz Results</h3>
              <div class="score-circle">
                <span class="score-value">{{ quizScore.correct }}</span>
                <span class="score-total">/ {{ quizScore.total }}</span>
              </div>
              <p class="score-percentage">
                {{ ((quizScore.correct / quizScore.total) * 100).toFixed(0) }}% Correct
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side - Lessons List -->
    <div class="right-section">
      <div class="lessons-container">
        <div class="lessons-header">
          <i class="bi bi-collection-play"></i>
          <h3>Lessons</h3>
        </div>

        <div class="lessons-list">
          <div *ngFor="let lesson of lessons; let i = index" class="lesson-item"
            [class.active]="currentLesson?.id === lesson.id" [class.locked]="!canAccessLesson(lesson)"
            (click)="selectLesson(lesson)">
            <div class="lesson-number">
              <i *ngIf="canAccessLesson(lesson)" class="bi bi-play-circle"></i>
              <i *ngIf="!canAccessLesson(lesson)" class="bi bi-lock-fill"></i>
            </div>

            <div class="lesson-info">
              <h4>{{ lesson.title }}</h4>
              <p>
                {{ lesson.subtitle || getLessonSubtitle(lesson, i) }}
              </p>
            </div>

            <span *ngIf="lesson.isFree" class="free-badge">Free</span>
            <i *ngIf="!canAccessLesson(lesson)" class="bi bi-lock-fill lesson-lock-icon"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Locked Lesson Modal -->
  <div class="modal-overlay" *ngIf="showLockedModal" (click)="closeLockedModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-icon">
        <i class="bi bi-lock-fill"></i>
      </div>
      <h3>This lesson is locked</h3>
      <p>Enroll in this course to unlock all lessons and get full access to the content.</p>

      <div class="modal-actions">
        <button class="btn-modal-cancel" (click)="closeLockedModal()">Maybe Later</button>
        <button class="btn-modal-enroll" (click)="enrollFromModal()">
          <i class="bi bi-bookmark-check"></i>
          Enroll Now
        </button>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="error-container">
    <i class="bi bi-exclamation-circle"></i>
    <p>{{ errorMessage }}</p>
    <button class="btn-retry" (click)="loadCourseData()">Retry</button>
  </div>
</div>